<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Interactive Map Hotspot Editor</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
    }
    .editor-header {
      padding: 10px;
      background: #222;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .map-container {
      position: relative;
      width: 100vw;
      height: calc(100vh - 60px);
      overflow: auto;
      background: #111;
    }
    .map-container img {
      display: block;
      max-width: none;
    }
    .hotspot {
      position: absolute;
      border: 2px dashed red;
      background: rgba(255, 0, 0, 0.2);
    }
    .export-area {
      width: 100%;
      height: 200px;
    }
    .form-overlay {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0,0,0,0.8);
      padding: 10px;
      color: white;
      z-index: 10;
    }
  </style>
</head>
<body>

<div class="editor-header">
  <div>
    <strong>Hotspot Editor</strong> â€” Click and drag on the map to create hotspots
  </div>
  <button onclick="exportHotspots()">Export JSON</button>
</div>

<div class="map-container" id="mapContainer">
  <img src="images/maps/Imperial Bunker Map.png" id="mapImage" alt="Map">
</div>

<textarea id="exportOutput" class="export-area" placeholder="Exported JSON will appear here..."></textarea>

<script>
  const mapContainer = document.getElementById('mapContainer');
  const mapImage = document.getElementById('mapImage');
  const exportOutput = document.getElementById('exportOutput');
  const hotspots = [];

  let isDrawing = false;
  let startX, startY, hotspotEl;

  mapContainer.addEventListener("mousedown", (e) => {
    if (e.target !== mapImage) return;

    isDrawing = true;
    const rect = mapContainer.getBoundingClientRect();
    startX = e.clientX - rect.left + mapContainer.scrollLeft;
    startY = e.clientY - rect.top + mapContainer.scrollTop;

    hotspotEl = document.createElement("div");
    hotspotEl.className = "hotspot";
    hotspotEl.style.left = `${startX}px`;
    hotspotEl.style.top = `${startY}px`;
    mapContainer.appendChild(hotspotEl);
  });

  mapContainer.addEventListener("mousemove", (e) => {
    if (!isDrawing) return;
    const rect = mapContainer.getBoundingClientRect();
    const currX = e.clientX - rect.left + mapContainer.scrollLeft;
    const currY = e.clientY - rect.top + mapContainer.scrollTop;

    const width = currX - startX;
    const height = currY - startY;

    hotspotEl.style.width = `${Math.abs(width)}px`;
    hotspotEl.style.height = `${Math.abs(height)}px`;
    hotspotEl.style.left = `${width < 0 ? currX : startX}px`;
    hotspotEl.style.top = `${height < 0 ? currY : startY}px`;
  });

  mapContainer.addEventListener("mouseup", () => {
    if (!isDrawing) return;
    isDrawing = false;

    const rect = hotspotEl.getBoundingClientRect();
    const containerRect = mapContainer.getBoundingClientRect();
    const x = rect.left - containerRect.left + mapContainer.scrollLeft;
    const y = rect.top - containerRect.top + mapContainer.scrollTop;
    const width = rect.width;
    const height = rect.height;

    const imagePath = prompt("Enter the path to the full image (e.g. rooms/IB Map 01.png):");
    if (!imagePath) {
      hotspotEl.remove();
      return;
    }

    hotspots.push({ x: Math.round(x), y: Math.round(y), width: Math.round(width), height: Math.round(height), image: imagePath });
  });

  function exportHotspots() {
    const output = {
      image: "maps/Imperial Bunker Map.png",
      hotspots
    };
    exportOutput.value = JSON.stringify(output, null, 2);
  }
</script>

</body>
</html>
